<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon CJ</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-container">
                    <div class="logo">
                        <div class="logo-icon"><i class="fas fa-dragon"></i></div>
                        <div class="logo-text">
                            <h1>Pokemon CJ</h1>
                            <div class="subtitle">Online Pokémon Game</div>
                        </div>
                    </div>
                    
                    <nav class="nav-menu">
                        <a href="#" class="nav-item active"><i class="fas fa-home"></i> Главная</a>
                        <!-- Убрали "Играть" -->
                        <a href="#" class="nav-item"><i class="fas fa-newspaper"></i> Новости</a>
                        <a href="#" class="nav-item"><i class="fas fa-users"></i> Сообщество</a>
                        
                        <div class="auth-section">
                            {% if current_user.is_authenticated %}
                                <div class="user-header">
                                    <div class="user-info">
                                        <div class="user-avatar">
                                            {{ current_user.username[:2]|upper }}
                                        </div>
                                        <div class="user-details">
                                            <div class="user-name">{{ current_user.username }}</div>
                                            <div class="user-level">Уровень {{ current_user.level }}</div>
                                        </div>
                                    </div>
                                    <div class="user-actions">
                                        <a href="#" class="world-btn">
                                            <i class="fas fa-globe"></i> В мир
                                        </a>
                                        <button class="logout-btn" hx-get="{{ url_for('main.logout') }}" hx-target="body">
                                            <i class="fas fa-sign-out-alt"></i> Выйти
                                        </button>
                                    </div>
                                </div>
                            {% else %}
                                <button class="auth-btn login" onclick="showAuth('login')">
                                    <i class="fas fa-sign-in-alt"></i> Вход
                                </button>
                                <button class="auth-btn register" onclick="showAuth('register')">
                                    <i class="fas fa-user-plus"></i> Регистрация
                                </button>
                            {% endif %}
                        </div>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero-section">
            <div class="container">
                <h1 class="hero-title">ДОБРО ПОЖАЛОВАТЬ В POKEMON CJ</h1>
                <p class="hero-subtitle">
                    Браузерная онлайн игра по мотивам вселенной Pokémon. Присоединяйся и развивай своих питомцев, сражайся с другими игроками, исследуй локации, участвуй в различных ивентах. Стань настоящим тренером карманных монстров!
                </p>
                
                {% if not current_user.is_authenticated %}
                    <button class="cta-button" onclick="showAuth('register')">
                        <i class="fas fa-play-circle"></i> Начать игру
                    </button>
                {% else %}
                    <a href="#" class="cta-button">
                        <i class="fas fa-play-circle"></i> Продолжить игру
                    </a>
                {% endif %}
            </div>
        </section>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <div class="single-column">
                    <div class="content-block">
                        <div class="block-header">
                            <h2 class="block-title"><i class="fas fa-newspaper"></i> Последние новости</h2>
                            <div class="block-actions">
                                <button class="btn-icon" hx-get="{{ url_for('main.get_news') }}" hx-target="#news-content" hx-swap="innerHTML">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="news-container">
                            <div class="news-list" id="news-content" hx-get="{{ url_for('main.get_news') }}" hx-trigger="load">
                                <div class="loading">Загрузка новостей</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Auth Modal -->
        <div id="auth-modal" class="auth-modal" style="display: none;">
            <div class="auth-modal-content">
                <div class="auth-modal-header">
                    <h3>Войти в игру</h3>
                    <button class="auth-modal-close" onclick="hideAuth()">&times;</button>
                </div>
                <div class="auth-modal-body">
                    <div class="form-tabs">
                        <button class="tab-btn active" onclick="switchTab('login')">Вход</button>
                        <button class="tab-btn" onclick="switchTab('register')">Регистрация</button>
                    </div>
                    
                    <div class="auth-forms">
                        <form id="login-form" hx-post="/" hx-target="#auth-message" hx-swap="innerHTML">
                            <input type="hidden" name="login" value="1">
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" name="email" class="form-input" required placeholder="your@email.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Пароль</label>
                                <input type="password" name="password" class="form-input" required placeholder="••••••••">
                            </div>
                            <button type="submit" class="btn-submit">Войти в аккаунт</button>
                        </form>
                        
                        <form id="register-form" style="display: none;" hx-post="/" hx-target="#auth-message" hx-swap="innerHTML">
                            <input type="hidden" name="register" value="1">
                            <div class="form-group">
                                <label class="form-label">Имя пользователя</label>
                                <input type="text" name="username" class="form-input" required placeholder="Тренер" minlength="3" maxlength="20">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" name="email" class="form-input" required placeholder="your@email.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Пароль</label>
                                <input type="password" name="password" class="form-input" required placeholder="Минимум 6 символов" minlength="6">
                            </div>
                            <button type="submit" class="btn-submit">Создать аккаунт</button>
                        </form>
                        
                        <div id="auth-message" style="margin-top: 16px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-links">
                        <a href="#" class="footer-link">Правила</a>
                        <a href="#" class="footer-link">Контакты</a>
                        <a href="#" class="footer-link">Помощь</a>
                        <a href="#" class="footer-link">Донат</a>
                    </div>
                    <div class="copyright">
                        © 2024 Pokemon CJ. Все права защищены.
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Auth modal management
        function showAuth(formType) {
            const modal = document.getElementById('auth-modal');
            modal.style.display = 'flex';
            switchTab(formType);
        }
        
        function hideAuth() {
            const modal = document.getElementById('auth-modal');
            modal.style.display = 'none';
        }
        
        function switchTab(tab) {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const tabs = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(t => t.classList.remove('active'));
            
            if (tab === 'login') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                tabs[0].classList.add('active');
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                tabs[1].classList.add('active');
            }
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('auth-modal');
            if (event.target == modal) {
                hideAuth();
            }
        }
        
        // Handle HTMX responses
        document.addEventListener('htmx:afterSwap', function(event) {
            if (event.detail.target.id === 'auth-message') {
                const response = event.detail.target.innerHTML;
                if (response.includes('Успешный') || response.includes('Регистрация успешна')) {
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                }
            }
        });
        
        // Auto-refresh news every 60 seconds
        setInterval(() => {
            const newsElement = document.getElementById('news-content');
            if (newsElement) htmx.trigger(newsElement, 'refresh');
        }, 60000);
    </script>
</body>
</html>